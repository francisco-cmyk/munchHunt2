import{R as E,r as i}from"./react-DGI8dM3C.js";import{r as V}from"./react-dom-b4hKtrb9.js";import{i as K}from"./fast-deep-equal-DaaPHwIQ.js";function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},M.apply(null,arguments)}function k(t,e){if(t==null)return{};var n={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.includes(o))continue;n[o]=t[o]}return n}function q(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function W(t){var e=q(t,"string");return typeof e=="symbol"?e:e+""}const I={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"},Y="https://maps.googleapis.com/maps/api/js";class P{static async load(e,n){var o;const s=e.libraries?e.libraries.split(","):[],r=this.serializeParams(e);this.listeners.push(n),(o=window.google)!=null&&(o=o.maps)!=null&&o.importLibrary?(this.serializedApiParams||(this.loadingStatus=I.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=r,this.initImportLibrary(e)),this.serializedApiParams&&this.serializedApiParams!==r&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");const l=["maps",...s];await Promise.all(l.map(a=>google.maps.importLibrary(a)))}static serializeParams(e){return[e.v,e.key,e.language,e.region,e.authReferrerPolicy,e.solutionChannel].join("/")}static initImportLibrary(e){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let n=null;const o=()=>n||(n=new Promise((s,r)=>{var l;const a=document.createElement("script"),d=new URLSearchParams;for(const[f,c]of Object.entries(e)){const m=f.replace(/[A-Z]/g,h=>"_"+h[0].toLowerCase());d.set(m,String(c))}d.set("loading","async"),d.set("callback","__googleMapsCallback__"),a.async=!0,a.src=Y+"?"+d.toString(),a.nonce=((l=document.querySelector("script[nonce]"))==null?void 0:l.nonce)||"",a.onerror=()=>{this.loadingStatus=I.FAILED,this.notifyLoadingStatusListeners(),r(new Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=I.LOADED,this.notifyLoadingStatusListeners(),s()},window.gm_authFailure=()=>{this.loadingStatus=I.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=I.LOADING,this.notifyLoadingStatusListeners(),document.head.append(a)}),n);google.maps.importLibrary=s=>o().then(()=>google.maps.importLibrary(s))}static notifyLoadingStatusListeners(){for(const e of this.listeners)e(this.loadingStatus)}}P.loadingStatus=I.NOT_LOADED;P.serializedApiParams=void 0;P.listeners=[];const Q=["onLoad","onError","apiKey","version","libraries"],X=["children"],ee="GMP_visgl_rgmlibrary_v1_default",D=E.createContext(null);function te(){const[t,e]=i.useState({});return{mapInstances:t,addMapInstance:(r,l="default")=>{e(a=>M({},a,{[l]:r}))},removeMapInstance:(r="default")=>{e(l=>k(l,[r].map(W)))},clearMapInstances:()=>{e({})}}}function ne(t){const{onLoad:e,onError:n,apiKey:o,version:s,libraries:r=[]}=t,l=k(t,Q),[a,d]=i.useState(P.loadingStatus),[f,c]=i.useReducer((u,p)=>u[p.name]?u:M({},u,{[p.name]:p.value}),{}),m=i.useMemo(()=>r==null?void 0:r.join(","),[r]),h=i.useMemo(()=>JSON.stringify(M({apiKey:o,version:s},l)),[o,s,l]),g=i.useCallback(async u=>{var p;if(f[u])return f[u];if(!((p=google)!=null&&(p=p.maps)!=null&&p.importLibrary))throw new Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");const y=await window.google.maps.importLibrary(u);return c({name:u,value:y}),y},[f]);return i.useEffect(()=>{(async()=>{try{const u=M({key:o},l);s&&(u.v=s),(m==null?void 0:m.length)>0&&(u.libraries=m),(u.channel===void 0||u.channel<0||u.channel>999)&&delete u.channel,u.solutionChannel===void 0?u.solutionChannel=ee:u.solutionChannel===""&&delete u.solutionChannel,await P.load(u,p=>d(p));for(const p of["core","maps",...r])await g(p);e&&e()}catch(u){n?n(u):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",u)}})()},[o,m,h]),{status:a,loadedLibraries:f,importLibrary:g}}const xe=t=>{const{children:e}=t,n=k(t,X),{mapInstances:o,addMapInstance:s,removeMapInstance:r,clearMapInstances:l}=te(),{status:a,loadedLibraries:d,importLibrary:f}=ne(n),c=i.useMemo(()=>({mapInstances:o,addMapInstance:s,removeMapInstance:r,clearMapInstances:l,status:a,loadedLibraries:d,importLibrary:f}),[o,s,r,l,a,d,f]);return E.createElement(D.Provider,{value:c},e)};function oe(t,e){for(const n of se){const o=e[n],s=G[n];i.useEffect(()=>{if(!t||!o)return;const r=google.maps.event.addListener(t,s,l=>{o(re(s,t,l))});return()=>r.remove()},[t,s,o])}}function re(t,e,n){const o={type:t,map:e,detail:{},stoppable:!1,stop:()=>{}};if(ae.includes(t)){const r=o,l=e.getCenter(),a=e.getZoom(),d=e.getHeading()||0,f=e.getTilt()||0,c=e.getBounds();return(!l||!c||!Number.isFinite(a))&&console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),r.detail={center:(l==null?void 0:l.toJSON())||{lat:0,lng:0},zoom:a||0,heading:d,tilt:f,bounds:(c==null?void 0:c.toJSON())||{north:90,east:180,south:-90,west:-180}},r}else if(ie.includes(t)){var s;if(!n)throw new Error("[createEvent] mouse events must provide a srcEvent");const r=o;return r.domEvent=n.domEvent,r.stoppable=!0,r.stop=()=>n.stop(),r.detail={latLng:((s=n.latLng)==null?void 0:s.toJSON())||null,placeId:n.placeId},r}return o}const G={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},ae=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],ie=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],se=Object.keys(G);function le(t,e){const n=i.useRef(void 0);(!n.current||!K(e,n.current))&&(n.current=e),i.useEffect(t,n.current)}const ue=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function ce(t,e){const n={},o=Object.keys(e);for(const s of o)ue.has(s)&&(n[s]=e[s]);le(()=>{t&&t.setOptions(n)},[n])}function U(){var t;return((t=i.useContext(D))==null?void 0:t.status)||I.NOT_LOADED}function de(t,e){const{viewport:n,viewState:o}=e,s=!!n;return i.useLayoutEffect(()=>{if(!t||!o)return;const{latitude:r,longitude:l,bearing:a,pitch:d,zoom:f}=o;t.moveCamera({center:{lat:r,lng:l},heading:a,tilt:d,zoom:f+1})},[t,o]),s}function fe(t){return!t||typeof t!="object"||!("lat"in t&&"lng"in t)?!1:Number.isFinite(t.lat)&&Number.isFinite(t.lng)}function Z(t){return fe(t)?t:t.toJSON()}function ge(t,e,n){const o=n.center?Z(n.center):null;let s=null,r=null;o&&Number.isFinite(o.lat)&&Number.isFinite(o.lng)&&(s=o.lat,r=o.lng);const l=Number.isFinite(n.zoom)?n.zoom:null,a=Number.isFinite(n.heading)?n.heading:null,d=Number.isFinite(n.tilt)?n.tilt:null;i.useLayoutEffect(()=>{if(!t)return;const f={};let c=!1;s!==null&&r!==null&&(e.current.center.lat!==s||e.current.center.lng!==r)&&(f.center={lat:s,lng:r},c=!0),l!==null&&e.current.zoom!==l&&(f.zoom=l,c=!0),a!==null&&e.current.heading!==a&&(f.heading=a,c=!0),d!==null&&e.current.tilt!==d&&(f.tilt=d,c=!0),c&&t.moveCamera(f)})}const me=()=>{const t={position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"};return E.createElement("div",{style:t},E.createElement("h2",null,"Error: AuthFailure"),E.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",E.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."))};function pe(){const[t,e]=i.useState(null),n=i.useCallback(o=>e(o),[e]);return[t,n]}function $(){return U()===I.LOADED}function he(){const[,t]=i.useReducer(e=>e+1,0);return t}function ve(t,e){const n=t.getCenter(),o=t.getZoom(),s=t.getHeading()||0,r=t.getTilt()||0,l=t.getBounds();(!n||!l||!Number.isFinite(o))&&console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(e.current,{center:(n==null?void 0:n.toJSON())||{lat:0,lng:0},zoom:o||0,heading:s,tilt:r})}function Ee(t){const e=he(),n=i.useRef({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return i.useEffect(()=>{if(!t)return;const o=google.maps.event.addListener(t,"bounds_changed",()=>{ve(t,n),e()});return()=>o.remove()},[t,e]),n}const Ce=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],ye=["padding"];class z{static has(e){return this.entries[e]&&this.entries[e].length>0}static pop(e){return this.entries[e]&&this.entries[e].pop()||null}static push(e,n){this.entries[e]||(this.entries[e]=[]),this.entries[e].push(n)}}z.entries={};function be(t,e){const n=$(),[o,s]=i.useState(null),[r,l]=pe(),a=Ee(o),{id:d,defaultBounds:f,defaultCenter:c,defaultZoom:m,defaultHeading:h,defaultTilt:g,reuseMaps:u,renderingType:p,colorScheme:y}=t,v=k(t,Ce),T=t.zoom!==void 0||t.defaultZoom!==void 0,_=t.center!==void 0||t.defaultCenter!==void 0;!f&&(!T||!_)&&console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!v.center&&c&&(v.center=c),!v.zoom&&Number.isFinite(m)&&(v.zoom=m),!v.heading&&Number.isFinite(h)&&(v.heading=h),!v.tilt&&Number.isFinite(g)&&(v.tilt=g);for(const b of Object.keys(v))v[b]===void 0&&delete v[b];const w=i.useRef();return i.useEffect(()=>{if(!r||!n)return;const{addMapInstance:b,removeMapInstance:L}=e,{mapId:O}=t,A=`${O||"default"}:${p||"default"}:${y||"LIGHT"}`;let S,C;if(u&&z.has(A)?(C=z.pop(A),S=C.getDiv(),r.appendChild(S),C.setOptions(v),setTimeout(()=>C.setCenter(C.getCenter()),0)):(S=document.createElement("div"),S.style.height="100%",r.appendChild(S),C=new google.maps.Map(S,M({},v,p?{renderingType:p}:{},y?{colorScheme:y}:{}))),s(C),b(C,d),f){const{padding:F}=f,R=k(f,ye);C.fitBounds(R,F)}else(!T||!_)&&C.fitBounds({east:180,west:-180,south:-90,north:90});if(w.current){const{mapId:F,cameraState:R}=w.current;F!==O&&C.setOptions(R)}return()=>{w.current={mapId:O,cameraState:a.current},S.remove(),u?z.push(A,C):google.maps.event.clearInstanceListeners(C),s(null),L(d)}},[r,n,d,t.mapId,t.renderingType,t.colorScheme]),[o,l,a]}const J=E.createContext(null),Le=t=>{const{children:e,id:n,className:o,style:s}=t,r=i.useContext(D),l=U();if(!r)throw new Error("<Map> can only be used inside an <ApiProvider> component.");const[a,d,f]=be(t,r);ge(a,f,t),oe(a,t),ce(a,t);const c=de(a,t),m=!!t.controlled;i.useEffect(()=>{if(a)return c&&a.setOptions({disableDefaultUI:!0}),(c||m)&&a.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{a.setOptions({gestureHandling:t.gestureHandling,keyboardShortcuts:t.keyboardShortcuts})}},[a,c,m,t.gestureHandling,t.keyboardShortcuts]);const h=t.center?Z(t.center):null;let g=null,u=null;h&&Number.isFinite(h.lat)&&Number.isFinite(h.lng)&&(g=h.lat,u=h.lng);const p=i.useMemo(()=>{var T,_,w,b,L;return{center:{lat:(T=g)!=null?T:0,lng:(_=u)!=null?_:0},zoom:(w=t.zoom)!=null?w:0,heading:(b=t.heading)!=null?b:0,tilt:(L=t.tilt)!=null?L:0}},[g,u,t.zoom,t.heading,t.tilt]);i.useLayoutEffect(()=>{if(!a||!m)return;a.moveCamera(p);const T=a.addListener("bounds_changed",()=>{a.moveCamera(p)});return()=>T.remove()},[a,m,p]);const y=i.useMemo(()=>M({width:"100%",height:"100%",position:"relative",zIndex:c?-1:0},s),[s,c]),v=i.useMemo(()=>({map:a}),[a]);return l===I.AUTH_FAILURE?E.createElement("div",{style:M({position:"relative"},o?{}:y),className:o},E.createElement(me,null)):E.createElement("div",M({ref:d,"data-testid":"map",style:o?void 0:y,className:o},n?{id:n}:{}),a?E.createElement(J.Provider,{value:v},e):null)};Le.deckGLViewProps=!0;const B=new Set;function Me(...t){const e=JSON.stringify(t);B.has(e)||(B.add(e),console.error(...t))}const j=(t=null)=>{const e=i.useContext(D),{map:n}=i.useContext(J)||{};if(e===null)return Me("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;const{mapInstances:o}=e;return t!==null?o[t]||null:n||o.default||null};function Te(t){const e=$(),n=i.useContext(D);return i.useEffect(()=>{!e||!n||n.importLibrary(t)},[e,n,t]),(n==null?void 0:n.loadedLibraries[t])||null}function N(t,e,n){i.useEffect(()=>{if(!t||!e||!n)return;const o=google.maps.event.addListener(t,e,n);return()=>o.remove()},[t,e,n])}function x(t,e,n){i.useEffect(()=>{t&&(t[e]=n)},[t,e,n])}function H(t,e,n){i.useEffect(()=>{if(!(!t||!e||!n))return t.addEventListener(e,n),()=>t.removeEventListener(e,n)},[t,e,n])}function Oe(t){return t.nodeType===Node.ELEMENT_NODE}const Ie=E.createContext(null),_e={TOP_LEFT:["0%","0%"],TOP_CENTER:["50%","0%"],TOP:["50%","0%"],TOP_RIGHT:["100%","0%"],LEFT_CENTER:["0%","50%"],LEFT_TOP:["0%","0%"],LEFT:["0%","50%"],LEFT_BOTTOM:["0%","100%"],RIGHT_TOP:["100%","0%"],RIGHT:["100%","50%"],RIGHT_CENTER:["100%","50%"],RIGHT_BOTTOM:["100%","100%"],BOTTOM_LEFT:["0%","100%"],BOTTOM_CENTER:["50%","100%"],BOTTOM:["50%","100%"],BOTTOM_RIGHT:["100%","100%"],CENTER:["50%","50%"]},we=({children:t,styles:e,className:n,anchorPoint:o})=>{const[s,r]=o??_e.BOTTOM,l=`translate(50%, 100%) translate(-${s}, -${r})`;return E.createElement("div",{style:{transform:l}},E.createElement("div",{className:n,style:e},t))};function Se(t){const[e,n]=i.useState(null),[o,s]=i.useState(null),r=j(),l=Te("marker"),{children:a,onClick:d,className:f,onMouseEnter:c,onMouseLeave:m,onDrag:h,onDragStart:g,onDragEnd:u,collisionBehavior:p,clickable:y,draggable:v,position:T,title:_,zIndex:w}=t,b=i.Children.count(a);return i.useEffect(()=>{if(!r||!l)return;const L=new l.AdvancedMarkerElement;L.map=r,n(L);let O=null;return b>0&&(O=document.createElement("div"),O.isCustomMarker=!0,L.content=O,s(O)),()=>{var A;L.map=null,(A=O)==null||A.remove(),n(null),s(null)}},[r,l,b]),i.useEffect(()=>{!e||!e.content||b>0||(e.content.className=f||"")},[e,f,b]),x(e,"position",T),x(e,"title",_??""),x(e,"zIndex",w),x(e,"collisionBehavior",p),i.useEffect(()=>{e&&(v!==void 0?e.gmpDraggable=v:h||g||u?e.gmpDraggable=!0:e.gmpDraggable=!1)},[e,v,h,u,g]),i.useEffect(()=>{if(!e)return;const L=y!==void 0||!!d||!!c||!!m;e.gmpClickable=L,L&&e!=null&&e.content&&Oe(e.content)&&(e.content.style.pointerEvents="none",e.content.firstElementChild&&(e.content.firstElementChild.style.pointerEvents="all"))},[e,y,d,c,m]),N(e,"click",d),N(e,"drag",h),N(e,"dragstart",g),N(e,"dragend",u),H(e==null?void 0:e.element,"mouseenter",c),H(e==null?void 0:e.element,"mouseleave",m),[e,o]}const ze=i.forwardRef((t,e)=>{const{children:n,style:o,className:s,anchorPoint:r}=t,[l,a]=Se(t),d=i.useMemo(()=>l?{marker:l}:null,[l]);return i.useImperativeHandle(e,()=>l,[l]),a?E.createElement(Ie.Provider,{value:d},V.createPortal(E.createElement(we,{anchorPoint:r,styles:o,className:s},n),a)):null}),Ae=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"];function ke(t){const[e,n]=i.useState(null),o=j(),{onClick:s,onDrag:r,onDragStart:l,onDragEnd:a,onMouseOver:d,onMouseOut:f}=t,c=k(t,Ae),{position:m,draggable:h}=c;return i.useEffect(()=>{if(!o){o===void 0&&console.error("<Marker> has to be inside a Map component.");return}const g=new google.maps.Marker(c);return g.setMap(o),n(g),()=>{g.setMap(null),n(null)}},[o]),i.useEffect(()=>{if(!e)return;const g=e,u=google.maps.event;return s&&u.addListener(g,"click",s),r&&u.addListener(g,"drag",r),l&&u.addListener(g,"dragstart",l),a&&u.addListener(g,"dragend",a),d&&u.addListener(g,"mouseover",d),f&&u.addListener(g,"mouseout",f),e.setDraggable(!!h),()=>{u.clearInstanceListeners(g)}},[e,h,s,r,l,a,d,f]),i.useEffect(()=>{e&&c&&e.setOptions(c)},[e,c]),i.useEffect(()=>{h||!m||!e||e.setPosition(m)},[h,m,e]),e}i.forwardRef((t,e)=>{const n=ke(t);return i.useImperativeHandle(e,()=>n,[n]),E.createElement(E.Fragment,null)});export{xe as A,Le as M,ze as a};
